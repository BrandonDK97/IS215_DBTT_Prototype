from flask import Flask, request , render_template
from flask_cors import CORS
import pickle
import pandas as pd



app = Flask(__name__)
CORS(app, supports_credentials=True)


@app.route("/")
def index():
    return render_template("index.html")


@app.route("/formScanner")
def formScanner():
    return render_template("formScanner.html")


@app.route("/enginePrediction")
def enginePrediction():
    return render_template("enginePrediction.html")

loaded_model = pickle.load(open("./model/predict_ship_maintenance_new.sav", 'rb'))

@app.route("/enginePredictionModel", methods=['POST'])
def enginePredictionModel():
    data = request.get_json()
    cat = data[0]
    eng = data[1]
    df = {}
    for i in range(0,len(cat)):
        df[cat[i]] = [eng[i]]
    df = pd.DataFrame(df)  
    y_pred = loaded_model.predict(df)
    return y_pred[0]

# test= [
# [25.0028,0.6213,60,462.54,536.82,1268.11,1044.44,7.05,9.02,176.17,1915.5,8029.36,0.94,36.71,164.37,2028.44,7881.78,10.8878,0.02,307,1915,84.93,14.43,8.5087],
# [41.9999,0.8411,100,445,550.23,1355.45,1118.18,3.91,5.71,138.68,2212.05,8338.02,1.02,42.36,130.97,2388.13,8093.43,9.3504,0.02,332,2212,100,10.66,6.3236],
# [0.001,0,100,518.67,642.85,1597.27,1409.29,14.62,21.61,553.88,2388.1,9066.45,1.3,47.48,521.25,2388.07,8141.44,8.4899,0.03,394,2388,100,38.83,23.2633],
# [42.0007,0.84,100,445,550,1355.39,1121.59,3.91,5.72,138.94,2212.04,8334.87,1.02,42.2,130.49,2388.11,8090.79,9.3576,0.02,331,2212,100,10.59,6.4056],
# [10.0039,0.25,100,489.05,605.22,1503.74,1316.07,10.52,15.5,394.29,2318.97,8789.65,1.26,45.62,371.52,2388.2,8139.39,8.7085,0.03,372,2319,100,28.49,17.0793],
# [42.0057,0.8409,100,445,549.74,1364.37,1131.12,3.91,5.71,138.57,2211.98,8337.54,1.02,42.24,130.92,2388.09,8095.59,9.4064,0.02,331,2212,100,10.58,6.2864],
# [35.0077,0.84,100,449.44,556.15,1377.27,1138.45,5.48,8,194.16,2223.1,8356.5,1.02,41.98,183.26,2388.22,8066.05,9.3333,0.02,336,2223,100,14.69,8.9815],
# [42.0055,0.84,100,445,550.38,1361.98,1129.44,3.91,5.72,138.34,2212.05,8330.31,1.02,42.14,130.3,2388.16,8097.54,9.389,0.02,332,2212,100,10.52,6.4172],
# [41.9987,0.84,100,445,550.3,1355.56,1135.97,3.91,5.72,138.07,2212,8336.92,1.02,42.32,130.26,2388.14,8091.28,9.3707,0.02,331,2212,100,10.51,6.3668],
# [42.0025,0.8416,100,445,550.25,1361.8,1131.23,3.91,5.72,137.66,2212.04,8332.33,1.02,42.34,129.63,2388.15,8086.32,9.3908,0.02,330,2212,100,10.67,6.318],
# [9.9994,0.25,100,489.05,604.91,1510.59,1311.45,10.52,15.5,394.16,2319.01,8786.28,1.26,45.41,371.8,2388.23,8135.35,8.68,0.03,371,2319,100,28.43,17.0462],
# [42.0043,0.8401,100,445,550.01,1361.3,1125.47,3.91,5.72,139.24,2212.03,8334.81,1.02,42.37,130.47,2388.1,8092.35,9.4004,0.02,332,2212,100,10.51,6.2841],
# [24.9981,0.62,60,462.54,537.12,1265.1,1051.57,7.05,9.03,175.66,1915.46,8026.12,0.94,36.93,164.25,2028.38,7878.9,10.9166,0.02,308,1915,84.93,14.16,8.4984]
# ]
# test = [[25.0028,0.6213,60,462.54,536.82,1268.11,1044.44,7.05,9.02,176.17,1915.5,8029.36,0.94,36.71,164.37,2028.44,7881.78,10.8878,0.02,307,1915,84.93,14.43,8.5087,197]]

# for i in test:
#     # print(i)
#     df = {}
#     cat = ['op_setting_1','op_setting_2','op_setting_3','sensor_1','sensor_2','sensor_3','sensor_4','sensor_5','sensor_6','sensor_7','sensor_8','sensor_9','sensor_10','sensor_11','sensor_12','sensor_13','sensor_14','sensor_15','sensor_16','sensor_17','sensor_18','sensor_19','sensor_20','sensor_21']
#     eng = i
#     for i in range(0,len(cat)):
#         df[cat[i]] = [eng[i]]
#     # print(df)
#     df = pd.DataFrame(df)  
#     # print(df)
#     y_pred = loaded_model.predict(df)
#     print(y_pred[0])
#     if y_pred[0] == 'y':
#         print(y_pred) 


if __name__ == "__main__":
    app.run(host='0.0.0.0',port=5000,debug=True)
    # app.run(host='0.0.0.0',port=5000)
    # app.run(host='0.0.0.0',port=5000, debug=True)


